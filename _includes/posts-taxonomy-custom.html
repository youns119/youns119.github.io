<!-- archive-single-custom.html 에서 사용하는 카테고리/태그 출력 -->

{%- if site.category_archive.type and post.categories[0] -%}

  {%- comment -%}
  Category URL 방식
  - liquid:  실제로는 MM 테마에서 category list 페이지에서 앵커(#)를 쓰는 경우가 있어 placeholder로 "#" 사용
  - jekyll-archives: /categories/<slug>/ 형태
  {%- endcomment -%}

  {%- assign category_path_type = "#" -%}
  {%- if site.category_archive.type == "jekyll-archives" -%}
    {%- assign category_path_type = "" -%}
  {%- endif -%}

  {%- comment -%}
  Tag URL 방식
  - liquid:  /tags/#<slug>  (앵커)  ← 여기서 절대 뒤에 "/" 붙이면 안 됨
  - jekyll-archives: /tags/<slug>/ (디렉터리)
  {%- endcomment -%}

  {%- assign tag_mode = site.tag_archive.type | default: "liquid" -%}

  {%- if site.category_archive.path and site.tag_archive.path -%}
    {%- capture post_categories -%}
      {%- for category in post.categories -%}
        {{ category | downcase }}|{{ category }}{%- unless forloop.last -%},{%- endunless -%}
      {%- endfor -%}
    {%- endcapture -%}
    {%- assign category_hashes = post_categories | split: ',' | sort -%}

    {%- capture post_tags -%}
      {%- for tag in post.tags -%}
        {{ tag | downcase }}|{{ tag }}{%- unless forloop.last -%},{%- endunless -%}
      {%- endfor -%}
    {%- endcapture -%}
    {%- assign tag_hashes = post_tags | split: ',' | sort -%}

    <span class="page__taxonomy">
      <span itemprop="keywords">
        {%- for hash in category_hashes -%}
          {%- assign kv = hash | split: '|' -%}
          {%- assign category_word = kv[1] | strip_newlines -%}
          {%- assign category_slug = category_word | slugify -%}

          <!-- category는 기존처럼 /<slug>/ 형태 유지 -->
          <a href="{{ site.category_archive.path | append: category_slug | append: '/' | relative_url }}"
             class="page__taxonomy-item-category" rel="tag">{{ category_word }}</a>
          {%- unless forloop.last -%}<span class="sep"> </span>{%- endunless -%}
        {%- endfor -%}

        {%- for hash in tag_hashes -%}
          {%- assign kv = hash | split: '|' -%}
          {%- assign tag_word = kv[1] | strip_newlines -%}
          {%- assign tag_slug = tag_word | slugify -%}

          {% if tag_mode == "jekyll-archives" %}
            <!-- /tags/<slug>/ -->
            <a href="{{ site.tag_archive.path | append: tag_slug | append: '/' | relative_url }}"
               class="page__taxonomy-item-tag" rel="tag">{{ tag_word }}</a>
          {% else %}
            <!-- /tags/#<slug> (앵커) -->
            <a href="{{ site.tag_archive.path | append: '#' | append: tag_slug | relative_url }}"
               class="page__taxonomy-item-tag" rel="tag">{{ tag_word }}</a>
          {% endif %}

          {%- unless forloop.last -%}<span class="sep"> </span>{%- endunless -%}
        {%- endfor -%}
      </span>
    </span>
  {%- endif -%}
{%- endif -%}
